@page "/items/{Id:guid}"
@using SharedModels
@inject Services.ItemApiClient ItemApi
@inject NavigationManager Nav

<style>
    .edit-header {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem
    }

        .edit-header h1 {
            margin: 0;
            font-size: 1.75rem
        }

        .edit-header .subtitle {
            color: #6b7280;
            margin: .25rem 0 0
        }

        .edit-header .actions {
            display: flex;
            gap: .5rem
        }

    .edit-form {
        max-width: 28rem;
        display: flex;
        flex-direction: column;
        gap: 1.25rem
    }

    .form-group label {
        font-weight: 600;
        margin-bottom: .25rem;
        display: block
    }

    .loader {
        padding: 2rem 0;
        text-align: center;
        color: #6b7280
    }</style>

<PageTitle>Edit @Item?.Name · Inventory</PageTitle>

<div class="edit-header">
    <div>
        <h1>Edit Item</h1>
        <p class="subtitle">Update catalogue details for <strong>@Item?.Sku</strong></p>
    </div>
    <div class="actions">
        <button class="btn btn-primary" @onclick="SaveAsync" disabled="@(Item is null)">Save</button>
        <button class="btn btn-outline-secondary" @onclick="Cancel">Cancel</button>
    </div>
</div>


@if (IsLoading)
{
    <div class="loader">Loading…</div>
}
else if (!string.IsNullOrWhiteSpace(ErrorMessage))
{
    <div class="alert alert-danger">@ErrorMessage</div>
}
else if (Item is null)
{
    <div class="alert alert-warning">Item not found.</div>
}
else
{
    <div class="edit-form">
        <div class="form-group">
            <label>SKU</label>
            <InputText class="form-control" @bind-Value="Item.Sku" />
        </div>

        <div class="form-group">
            <label>Name</label>
            <InputText class="form-control" @bind-Value="Item.Name" />
        </div>

        <div class="form-group">
            <label>Unit Price</label>
            <InputNumber class="form-control" step="0.01" @bind-Value="Item.UnitPrice" />
        </div>

        <div class="form-group">
            <label>Low-Stock Threshold</label>
            <InputNumber class="form-control" @bind-Value="Item.LowStockThreshold" />
        </div>
    </div>
}

@code {
    [Parameter] public Guid Id { get; set; }

    private DtoItem? Item;
    private bool IsLoading = true;
    private string? ErrorMessage;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            Item = await ItemApi.GetItemAsync(Id);
        }
        catch (Exception ex)
        {
            ErrorMessage = ex.Message;
        }
        finally
        {
            IsLoading = false;
        }
    }

    private async Task SaveAsync()
    {
        if (Item is null) return;

        var errors = new List<string>();
        if (!await ItemApi.UpdateItemAsync(Item, errors))
        {
            ErrorMessage = string.Join("; ", errors);
            return;
        }
        Nav.NavigateTo("/items");
    }

    private void Cancel() => Nav.NavigateTo("/items");
}